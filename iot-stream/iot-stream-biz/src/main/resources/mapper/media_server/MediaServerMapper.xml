<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.basiclab.iot.stream.mapper.MediaServerMapper">

    <!-- 添加媒体服务器 -->
    <insert id="add" parameterType="com.basiclab.iot.stream.media.bean.MediaServer">
        INSERT INTO wvp_media_server (
            id, ip, hook_ip, sdp_ip, stream_ip, http_port,
            http_ssl_port, rtmp_port, rtmp_ssl_port, rtp_proxy_port,
            rtsp_port, flv_port, flv_ssl_port, ws_flv_port,
            ws_flv_ssl_port, rtsp_ssl_port, auto_config, secret,
            rtp_enable, rtp_port_range, send_rtp_port_range, record_assist_port,
            record_day, record_path, default_server, type, create_time,
            update_time, transcode_suffix, server_id, hook_alive_interval
        ) VALUES (
                     #{id}, #{ip}, #{hookIp}, #{sdpIp}, #{streamIp}, #{httpPort},
                     #{httpSSlPort}, #{rtmpPort}, #{rtmpSSlPort}, #{rtpProxyPort},
                     #{rtspPort}, #{flvPort}, #{flvSSLPort}, #{wsFlvPort},
                     #{wsFlvSSLPort}, #{rtspSSLPort}, #{autoConfig}, #{secret},
                     #{rtpEnable}, #{rtpPortRange}, #{sendRtpPortRange}, #{recordAssistPort},
                     #{recordDay}, #{recordPath}, #{defaultServer}, #{type}, #{createTime},
                     #{updateTime}, #{transcodeSuffix}, #{serverId}, #{hookAliveInterval}
                 )
    </insert>

    <!-- 更新媒体服务器信息 -->
    <update id="update" parameterType="com.basiclab.iot.stream.media.bean.MediaServer">
        UPDATE wvp_media_server
        <set>
            update_time = #{updateTime},
            transcode_suffix = #{transcodeSuffix},
            <if test="ip != null">ip = #{ip},</if>
            <if test="hookIp != null">hook_ip = #{hookIp},</if>
            <if test="sdpIp != null">sdp_ip = #{sdpIp},</if>
            <if test="streamIp != null">stream_ip = #{streamIp},</if>
            <if test="httpPort != null">http_port = #{httpPort},</if>
            <if test="httpSSlPort != null">http_ssl_port = #{httpSSlPort},</if>
            <if test="rtmpPort != null">rtmp_port = #{rtmpPort},</if>
            <if test="rtmpSSlPort != null">rtmp_ssl_port = #{rtmpSSlPort},</if>
            <if test="rtpProxyPort != null">rtp_proxy_port = #{rtpProxyPort},</if>
            <if test="rtspPort != null">rtsp_port = #{rtspPort},</if>
            <if test="rtspSSLPort != null">rtsp_ssl_port = #{rtspSSLPort},</if>
            <if test="flvPort != null">flv_port = #{flvPort},</if>
            <if test="flvSSLPort != null">flv_ssl_port = #{flvSSLPort},</if>
            <if test="wsFlvPort != null">ws_flv_port = #{wsFlvPort},</if>
            <if test="wsFlvSSLPort != null">ws_flv_ssl_port = #{wsFlvSSLPort},</if>
            <if test="autoConfig != null">auto_config = #{autoConfig},</if>
            <if test="rtpEnable != null">rtp_enable = #{rtpEnable},</if>
            <if test="rtpPortRange != null">rtp_port_range = #{rtpPortRange},</if>
            <if test="sendRtpPortRange != null">send_rtp_port_range = #{sendRtpPortRange},</if>
            <if test="secret != null">secret = #{secret},</if>
            <if test="recordAssistPort != null">record_assist_port = #{recordAssistPort},</if>
            <if test="hookAliveInterval != null">hook_alive_interval = #{hookAliveInterval},</if>
            <if test="recordDay != null">record_day = #{recordDay},</if>
            <if test="recordPath != null">record_path = #{recordPath},</if>
            <if test="serverId != null">server_id = #{serverId},</if>
            <if test="type != null">type = #{type},</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 根据主机和端口更新媒体服务器 -->
    <update id="updateByHostAndPort" parameterType="com.basiclab.iot.stream.media.bean.MediaServer">
        UPDATE wvp_media_server
        <set>
            update_time = #{updateTime},
            <if test="id != null">id = #{id},</if>
            <if test="hookIp != null">hook_ip = #{hookIp},</if>
            <if test="sdpIp != null">sdp_ip = #{sdpIp},</if>
            <if test="streamIp != null">stream_ip = #{streamIp},</if>
            <if test="httpSSlPort != null">http_ssl_port = #{httpSSlPort},</if>
            <if test="rtmpPort != null">rtmp_port = #{rtmpPort},</if>
            <if test="rtmpSSlPort != null">rtmp_ssl_port = #{rtmpSSlPort},</if>
            <if test="rtpProxyPort != null">rtp_proxy_port = #{rtpProxyPort},</if>
            <if test="rtspPort != null">rtsp_port = #{rtspPort},</if>
            <if test="rtspSSLPort != null">rtsp_ssl_port = #{rtspSSLPort},</if>
            <if test="flvPort != null">flv_port = #{flvPort},</if>
            <if test="flvSSLPort != null">flv_ssl_port = #{flvSSLPort},</if>
            <if test="wsFlvPort != null">ws_flv_port = #{wsFlvPort},</if>
            <if test="wsFlvSSLPort != null">ws_flv_ssl_port = #{wsFlvSSLPort},</if>
            <if test="autoConfig != null">auto_config = #{autoConfig},</if>
            <if test="rtpEnable != null">rtp_enable = #{rtpEnable},</if>
            <if test="rtpPortRange != null">rtp_port_range = #{rtpPortRange},</if>
            <if test="sendRtpPortRange != null">send_rtp_port_range = #{sendRtpPortRange},</if>
            <if test="secret != null">secret = #{secret},</if>
            <if test="recordAssistPort != null">record_assist_port = #{recordAssistPort},</if>
            <if test="recordDay != null">record_day = #{recordDay},</if>
            <if test="recordPath != null">record_path = #{recordPath},</if>
            <if test="type != null">type = #{type},</if>
            <if test="transcodeSuffix != null">transcode_suffix = #{transcodeSuffix},</if>
            <if test="hookAliveInterval != null">hook_alive_interval = #{hookAliveInterval},</if>
            <if test="serverId != null">server_id = #{serverId},</if>
        </set>
        WHERE ip = #{ip} AND http_port = #{httpPort}
    </update>

    <!-- 根据ID和服务器ID查询单个媒体服务器 -->
    <select id="queryOne" resultType="com.basiclab.iot.stream.media.bean.MediaServer">
        SELECT *
        FROM wvp_media_server
        WHERE id = #{id} AND server_id = #{serverId}
    </select>

    <!-- 查询所有媒体服务器 -->
    <select id="queryAll" resultType="com.basiclab.iot.stream.media.bean.MediaServer">
        SELECT *
        FROM wvp_media_server
        WHERE server_id = #{serverId}
    </select>

    <!-- 删除单个媒体服务器 -->
    <delete id="delOne">
        DELETE FROM wvp_media_server
        WHERE id = #{id} AND server_id = #{serverId}
    </delete>

    <!-- 根据主机、端口和服务器ID查询媒体服务器 -->
    <select id="queryOneByHostAndPort" resultType="com.basiclab.iot.stream.media.bean.MediaServer">
        SELECT *
        FROM wvp_media_server
        WHERE ip = #{host}
          AND http_port = #{port}
          AND server_id = #{serverId}
    </select>

    <!-- 查询默认媒体服务器 -->
    <select id="queryDefault" resultType="com.basiclab.iot.stream.media.bean.MediaServer">
        SELECT *
        FROM wvp_media_server
        WHERE default_server = true
          AND server_id = #{serverId}
    </select>

    <!-- 查询所有带辅助端口的媒体服务器 -->
    <select id="queryAllWithAssistPort" resultType="com.basiclab.iot.stream.media.bean.MediaServer">
        SELECT *
        FROM wvp_media_server
        WHERE record_assist_port > 0
          AND server_id = #{serverId}
    </select>

</mapper>